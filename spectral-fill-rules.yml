functions:
  - query-parameters-pagination
  - operation-id
  - includes-string
  - validate-scopes
  - validate-resource-title
  
rules:
  bpi-resource-attributes-description:
    description: Every attribute inside properties SHOULD have the description.
    message: Model properties SHOULD have a description.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-description
    severity: warn
    given: $..properties[?(@.type !== "object" && @.name !== "formatoConta" && @.name !== "tipoUtilizacao" && @.name !== "integridade")]*
    recommended: true
    then:
      field: description
      function: truthy

  bpi-resource-attributes-examples:
    description: Model property `examples` SHOULD be present and non-empty string.
    message: Every attribute SHOULD have an example.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-examples
    recommended: true
    type: style
    given: $..properties[?(@.type == "string" || @.type == "integer" || @.type == "number")]*
    then:
      field: example
      function: truthy

  bpi-validate-content-in-response-body:
    description: The HTTP codes [200,201,202,206,400,404,409,500] MUST have description and content.
    message: Verbs MUST have description and content in response body.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-validate-content-in-response-body
    given: $.paths..responses.[200,201,202,206,400,404,409,500]*
    severity: error
    then:
      - field: description
        function: truthy
      - field: content
        function: truthy

  bpi-query-parameters-pagination:
    description: To implement pagination is mandatory to have `pageNumber` and `pageSize` as query parameters.
    message: "{{error}}"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-query-parameters-pagination
    severity: error
    given: $.paths.*.get
    then:
      function: query-parameters-pagination

  bpi-validate-operation-id:
    description: Validate that operation-id is compliant to BPI rules.
    message: "{{error}}"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-validate-operation-id
    severity: warn
    given: $.paths..operationId
    then:
      function: operation-id

  bpi-resource-attributes-max-length:
    description: Every attribute of type string (without a format defined) must have the maxLength filled.
    message: All attributes of type string (without a format defined) MUST have maxLenght filled.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-max-length
    recommended: true
    type: style
    given: $..properties[?(@.type == "string" && !@.format && !@.enum)]*
    severity: error
    then:
      - field: maxLength
        function: truthy

  bpi-enumeration-attributes-size:
    description: Each enumerated value need to have more than one letter.
    message: COULD the enum values have more than one letter?
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-enumeration-attributes-size
    severity: info
    given: $..enum.*
    then:
      field: value
      function: length
      functionOptions:
        min: 2

  bpi-validate-exception-word-flag:
    description: Try not to use the word flag in attributes' name.
    message: "{{error}}"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-validate-exception-word-flag
    severity: info
    given: $..properties.*~
    then:
      function: includes-string
      functionOptions: 
        string: flag

  bpi-path-parameter-example:
    description: "Path parameter SHOULD contain an example that is not an empty string."
    message: "Every path parameter SHOULD have an example."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-path-parameter-example
    recommended: true
    type: style
    severity: warn
    given: "$..parameters[?(@.in == 'path')].schema"
    then:
      field: example
      function: truthy

  bpi-query-parameter-example:
    description: "Query parameter SHOULD contain an example that is not an empty string."
    message: "Every query parameter SHOULD have an example."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-query-parameter-example
    recommended: true
    type: style
    severity: warn
    given: "$..parameters[?(@.in == 'query')].schema"
    then:
      field: example
      function: truthy

  bpi-resource-attributes-format-max-length:
    description: Every attribute of type string (with format defined different than uri) must not have the field maxLength filled.
    message: String attributes (with format defined different than uri) MUST NOT have maxLength filled.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-format-max-length
    recommended: true
    type: style
    given: $..properties[?(@.type == "string" && (@.format || @.enum) && @.maxLength && @.format !== "uri" && @.format !== "uri-reference")]*
    severity: error
    then:
        function: undefined

  bpi-attribute-name-id-suggestion:
    description: Attribute name starting with id should end with that keyword.
    message: Use the keyword Id at the end of the attribute name.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-attribute-name-id-suggestion
    recommended: true
    type: style
    severity: warn
    given: $..properties.*~
    then:
      function: pattern
      functionOptions:
        notMatch: '/^id[A-Z]\w*/'

  bpi-audience-possible-values:
    description: "x-fast-audience attribute MUST be filled with one of the following possibilities: business-external-public|business-external-partner|business-internal|component-internal"
    message: "x-fast-audience attribute MUST be filled with one of the following possibilities: business-external-public|business-external-partner|business-internal|component-internal"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-audience-possible-values
    severity: error
    given: "$.info.x-fast-audience"
    then:
      field: x-fast-audience
      function: enumeration
      functionOptions:
        values: 
          - "business-external-public"
          - "business-external-partner"
          - "business-internal"
          - "component-internal"

  bpi-resource-title-length:
    description: "The name/title of the resource MUST be less than or equal to 50 characters."
    message: "{{error}}"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-title-length
    severity: error
    given: "$..title"
    then:
      function: validate-resource-title

  bpi-security-id-length:
    description: "The securityId field MUST be less than or equal to 20 characters."
    message: "The securityId field MUST be less than or equal to 20 characters."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-security-id-length
    severity: error
    given: "$.x-fast-api-metadata"
    then:
      field: securityId
      function: length
      functionOptions:
        max: 20

  bpi-validate-scopes:
    description: Validate that the scope of a security scheme is compliant to BPI rules.
    message: "{{error}}"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-validate-scopes
    severity: error
    given: $.components.securitySchemes..scopes
    then:
      function: validate-scopes

  bpi-resource-attributes-pattern:
    description: Every attribute of type string (without a format defined) should have the pattern filled.
    message: All attributes of type string (without a format defined) should have pattern filled.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-pattern
    given: $..properties[?(@.type == "string" && !@.format && !@.enum)]*
    severity: warn
    then:
      - field: pattern
        function: truthy

  bpi-resource-attributes-integer:
    description: You should define if your integer attribute is int32 or int64.
    message: Every attribute of type integer should have its format defined.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-integer
    given: $..properties[?(@.type == "integer")]*
    severity: warn
    then:
      - field: format
        function: truthy
      - field: format
        function: enumeration
        functionOptions:
          values: 
            - "int32"
            - "int64"

  bpi-resource-attributes-integer-min-max:
    description: You must define a minimum and maximum value for an integer attribute.
    message: Every attribute of type integer must have a minimum and maximum.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-integer-min-max
    given: $..properties[?(@.type == "integer")]*
    severity: error
    then:
      - field: minimum
        function: defined
      - field: maximum
        function: defined

  bpi-resource-attributes-number:
    description: You should define if your number attribute is float or double.
    message: Every attribute of type number should have its format defined.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-number
    given: $..properties[?(@.type == "number")]*
    severity: warn
    then:
      - field: format
        function: truthy
      - field: format
        function: enumeration
        functionOptions:
          values: 
            - "float"
            - "double"

  bpi-resource-attributes-number-min-max:
    description: You must define a minimum and maximum value for a number attribute.
    message: Every attribute of type number must have a minimum and maximum.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-number-min-max
    given: $..properties[?(@.type == "number")]*
    severity: error
    then:
      - field: minimum
        function: defined
      - field: maximum
        function: defined

  bpi-resource-attributes-array-min-max:
    description: You must define a minimum and maximum number of items for an array attribute.
    message: Every attribute of type array must have a minimum and maximum number of items.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-array-min-max
    given: $..properties[?(@.type == "array")]*
    severity: error
    then:
      - field: minItems
        function: defined
      - field: maxItems
        function: defined

  bpi-resource-attributes-array-items:
    description: You must define the type of the items for an array attribute. They can have a predefined subtype or could be a reference for a created schema.
    message: Every attribute of type array must have the type of its items defined.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-array-items
    given: $..properties[?(@.type == "array")]*
    severity: error
    then:
      - field: items
        function: truthy

  bpi-resource-attributes-array-different-items:
    description: You shouldn't define different types of items for an array attribute. Using oneOf or anyOf is not recommended.
    message: Every attribute of type array shouldn't have different types for its items.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-array-different-items
    given: $..properties[?(@.type == "array")].items
    severity: warn
    then:
      - field: oneOf
        function: undefined
      - field: anyOf
        function: undefined

  bpi-resource-attributes-object-properties:
    description: You should define the properties for every object attribute with the necessary content.
    message: Every attribute of type object should have its properties defined.
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-resource-attributes-object-properties
    given: $..[?(@.type == 'object')]
    severity: warn
    then:
      field: properties
      function: truthy

  bpi-responses-json:
    description: You should define the properties for every object attribute with the necessary content.
    message: Response content type should be application/json or application/problem+json
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/b7c5ed794d032-fill#bpi-responses-json
    given: $.paths[*][*].responses[*].content
    severity: warn
    then:
      field: "@key"
      function: enumeration
      functionOptions:
        values:
        - application/json
        - application/problem+json

  bpi-resource-attributes-canonical-types:
    description: Attribute names must not be keywords unless they are references
    message: "Attribute '{{property}}' is not allowed as it matches a restricted keyword"
    given: $..properties
    then:
      field: "@key"
      function: enumeration
      functionOptions:
        values:
        - taxIdentificationNumber
        - application/problem+json