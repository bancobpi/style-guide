functions:
  - http-error-code-reference

rules:
  bpi-http-error-code-reference:
    description: HTTP Code erros response MUST reference designLibrary/error-block-(httpCode).
    message: "{{error}}"
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-http-error-code-reference
    severity: error
    given: $.paths..responses[?( @property >= 400 && @property <= 500)].content.application/json.schema.*
    resolved: false
    then:
      function: http-error-code-reference

  bpi-allowed-get-list-http-code:
    description: Mandatory HTTP codes on GET List.
    message: In GET verbs the HTTP codes MUST be [200,206,400,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-get-list-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") == -1)]..[?(@property == 'get')].responses
    then:
      - field: "200"
        function: truthy
      - field: "206"
        function: truthy
      - field: "400"
        function: truthy
      - field: "500"
        function: truthy

  bpi-not-allowed-get-list-http-code:  
    description: Validate HTTP codes allowed in WhitePaper on GET List.
    message: "In GET verbs the HTTP codes MUST be [200,206,400,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-get-list-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") == -1)]..[?(@property == 'get')].responses[?(@property !== '200' && @property !== '206' && @property !== '400' && @property !== '500')]~
    then:
      function: undefined

  bpi-allowed-get-list-id-http-code:
    description: Mandatory HTTP codes on GET List with ID.
    message: In GET List with ID verbs the HTTP codes MUST be [200,206,400,404,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-get-list-id-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'get')].responses
    then:
      - field: "200"
        function: truthy
      - field: "206"
        function: truthy
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "500"
        function: truthy

  bpi-not-allowed-get-list-id-http-code:       
    description: Validate HTTP codes allowed in WhitePaper on GET List with ID.
    message: "In GET List with ID verbs the HTTP codes MUST be [200,206,400,404,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-get-list-id-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'get')].responses[?(@property !== '200' && @property !== '206' && @property !== '400' && @property !== '404' && @property !== '500')]~
    then:
      function: undefined

  bpi-allowed-get-by-id-http-code:
    description: Mandatory HTTP codes on GET by ID.
    message: In GET by ID verbs the HTTP codes MUST be [200,400,404,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-get-by-id-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") !== -1 && @property.indexOf("/{id}/") == -1)]..[?(@property == 'get')].responses
    then:
      - field: "200"
        function: truthy
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "500"
        function: truthy

  bpi-not-allowed-get-by-id-http-code:   
    description: Validate HTTP codes allowed in WhitePaper on GET by ID.
    message: "In GET by ID verbs the HTTP codes MUST be [200,400,404,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-get-by-id-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") !== -1 && @property.indexOf("/{id}/") == -1)]..[?(@property == 'get')].responses[?(@property !== '200' && @property !== '400' && @property !== '404' && @property !== '500')]~
    then:
      function: undefined

  bpi-allowed-put-http-code:
    description: Mandatory HTTP codes on PUT.
    message: In PUT verbs the HTTP codes MUST be [200,400,404,409,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-put-http-code
    severity: error
    given: $.paths..[?(@property == 'put')].responses
    then:
      - field: "200"
        function: truthy
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy

  bpi-not-allowed-put-http-code:       
    description: Validate HTTP codes allowed in WhitePaper on PUT.
    message: "In PUT verbs the HTTP codes MUST be [200,400,404,409,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-put-http-code
    severity: error
    given: $.paths..[?(@property == 'put')].responses[?(@property !== '200' && @property !== '400' && @property !== '404' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined

  bpi-allowed-post-http-code:
    description: Mandatory HTTP codes on POST.
    message: In POST verbs the HTTP codes MUST be [(201 or 202),400,409,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-post-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") == -1)]..[?(@property == 'post')].responses
    then:
      - field: "400"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy
      - functionOptions:    
          properties:
            - "201"
            - "202"
        function: xor

  bpi-not-allowed-post-http-code:   
    description: Validate HTTP codes allowed in WhitePaper on POST.
    message: "In POST verbs the HTTP codes MUST be [(201 or 202),400,409,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-post-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") == -1)]..[?(@property == 'post')].responses[?(@property !== '201' && @property !== '202' && @property !== '400' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined

  bpi-allowed-post-by-id-http-code:
    description: Mandatory HTTP codes on POST with ID.
    message: In POST by ID verbs the HTTP codes MUST be [(201 or 202),400,404,409,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-post-by-id-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'post')].responses
    then:
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy
      - functionOptions:    
          properties:
            - "201"
            - "202"
        function: xor

  bpi-not-allowed-post-by-id-http-code:   
    description: Validate HTTP codes allowed in WhitePaper on POST with ID.
    message: "In POST verbs the HTTP codes MUST be [(201 or 202),400,404,409,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-post-by-id-http-code
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'post')].responses[?(@property !== '201' && @property !== '202' && @property !== '400' && @property !== '404' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined

  bpi-allowed-delete-http-code:
    description: Mandatory HTTP codes on DELETE.
    message: In DELETE verbs the HTTP codes MUST be [(200 or 204),400,404,409,500].
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-allowed-delete-http-code
    severity: error
    given: $.paths..[?(@property == 'delete')].responses
    then:
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy
      - functionOptions:    
          properties:
            - "200"
            - "204"
        function: xor

  bpi-not-allowed-delete-http-code:   
    description: Validate HTTP codes allowed in WhitePaper on DELETE.
    message: "In DELETE verbs the HTTP codes MUST be [(200 or 204),400,404,409,500] and not: {{property}}."
    documentationUrl: https://bancobpi.stoplight.io/docs/style-guide/ZG9jOjUxMTY4Nzk4-status-code-rules-specification#bpi-not-allowed-delete-http-code
    severity: error
    given: $.paths..[?(@property == 'delete')].responses[?(@property !== '200' && @property !== '204' && @property !== '400' && @property !== '404' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined