functions:
  - http-error-code-reference

rules:

  # HTTP Code erros response MUST reference designLibrary/error-block-(httpCode)).yaml 
  # e.g designLibrary/error-block-400.yaml
  bpi-http-erros-code-reference:
    severity: error
    given: $.paths..responses[?( @property >= 300 && @property <= 500)].content.application/json.schema.*
    resolved: false
    then:
      function: http-error-code-reference

  # Mandatory HTTP codes on GET List e.g: /stores
  bpi-allowed-get-list-http-code:
    description: In GET verbs the HTTP codes MUST be [200,206,400,500]
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") == -1)]..[?(@property == 'get')].responses
    then:
      - field: "200"
        function: truthy
      - field: "206"
        function: truthy
      - field: "400"
        function: truthy
      - field: "500"
        function: truthy

  # Validate HTTP codes allowed in WhitePaper on GET List.
  bpi-not-allowed-get-list-http-code:  
    description: In GET verbs the HTTP codes MUST be [200,206,400,500] and not {{property}}
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") == -1)]..[?(@property == 'get')].responses[?(@property !== '200' && @property !== '206' && @property !== '400' && @property !== '500')]~
    then:
      function: undefined

  # Mandatory HTTP codes on GET List with ID e.g: /stores/{id}/accounting-days 
  bpi-allowed-get-list-id-http-code:
    description: In GET List with ID verbs the HTTP codes MUST be [200,206,400,404,500]
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'get')].responses
    then:
      - field: "200"
        function: truthy
      - field: "206"
        function: truthy
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "500"
        function: truthy

  # Validate HTTP codes allowed in WhitePaper on GET List with ID.
  bpi-not-allowed-get-list-id-http-code:       
    description: In GET List with ID verbs the HTTP codes MUST be [200,206,400,404,500] and not {{property}}
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'get')].responses[?(@property !== '200' && @property !== '206' && @property !== '400' && @property !== '404' && @property !== '500')]~
    then:
      function: undefined

  # Mandatory HTTP codes on GET by ID e.g: /stores/{id}
  bpi-allowed-get-by-id-http-code:
    description: In GET by ID verbs the HTTP codes MUST be [200,400,404,500]
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") !== -1 && @property.indexOf("/{id}/") == -1)]..[?(@property == 'get')].responses
    then:
      - field: "200"
        function: truthy
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "500"
        function: truthy

  # Validate HTTP codes allowed in WhitePaper on GET by ID.
  bpi-not-allowed-get-by-id-http-code:   
    description: In GET by ID verbs the HTTP codes MUST be [200,400,404,500] and not {{property}}
    severity: error
    given: $.paths[?(@property.indexOf("/{id}") !== -1 && @property.indexOf("/{id}/") == -1)]..[?(@property == 'get')].responses[?(@property !== '200' && @property !== '400' && @property !== '404' && @property !== '500')]~
    then:
      function: undefined

  # Mandatory HTTP codes on PUT
  bpi-allowed-put-http-code:
    description: In PUT verbs the HTTP codes MUST be [200,400,404,409,500]
    severity: error
    given: $.paths..[?(@property == 'put')].responses
    then:
      - field: "200"
        function: truthy
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy

  # Validate HTTP codes allowed in WhitePaper on PUT.
  bpi-not-allowed-put-http-code:       
    description: In PUT verbs the HTTP codes MUST be [200,400,404,409,500] and not {{property}}
    severity: error
    given: $.paths..[?(@property == 'put')].responses[?(@property !== '200' && @property !== '400' && @property !== '404' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined

  # Mandatory HTTP codes on POST
  bpi-allowed-post-http-code:
    description: In POST verbs the HTTP codes MUST be [(201 or 202),400,409,500]
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") == -1)]..[?(@property == 'post')].responses
    then:
      - field: "400"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy
      - functionOptions:    
          properties:
            - "201"
            - "202"
        function: xor

  # Validate HTTP codes allowed in WhitePaper on POST.
  bpi-not-allowed-post-http-code:   
    description: In POST verbs the HTTP codes MUST be [(201 or 202),400,409,500] and not {{property}}
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") == -1)]..[?(@property == 'post')].responses[?(@property !== '201' && @property !== '202' && @property !== '400' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined

  # Mandatory HTTP codes on POST by ID
  bpi-allowed-post-by-id-http-code:
    description: In POST by ID verbs the HTTP codes MUST be [(201 or 202),400,404,409,500]
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'post')].responses
    then:
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy
      - functionOptions:    
          properties:
            - "201"
            - "202"
        function: xor

  # Validate HTTP codes allowed in WhitePaper on POST by ID.
  bpi-not-allowed-post-by-id-http-code:   
    description: In POST verbs the HTTP codes MUST be [(201 or 202),400,404,409,500] and not {{property}}
    severity: error
    given: $.paths[?(@property.indexOf("/{id}/") !== -1)]..[?(@property == 'post')].responses[?(@property !== '201' && @property !== '202' && @property !== '400' && @property !== '404' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined

  # Mandatory HTTP codes on DELETE
  bpi-allowed-delete-http-code:
    description: In DELETE verbs the HTTP codes MUST be [(200 or 204),400,404,409,500]
    severity: error
    given: $.paths..[?(@property == 'delete')].responses
    then:
      - field: "400"
        function: truthy
      - field: "404"
        function: truthy
      - field: "409"
        function: truthy
      - field: "500"
        function: truthy
      - functionOptions:    
          properties:
            - "200"
            - "204"
        function: xor

  # Validate HTTP codes allowed in WhitePaper on DELETE.
  bpi-not-allowed-delete-http-code:   
    description: In DELETE verbs the HTTP codes MUST be [(200 or 204),400,404,409,500] and not {{property}}
    severity: error
    given: $.paths..[?(@property == 'delete')].responses[?(@property !== '200' && @property !== '204' && @property !== '400' && @property !== '404' && @property !== '409' && @property !== '500')]~
    then:
      function: undefined